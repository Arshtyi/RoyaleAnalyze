# <center> RoyaleAnalyze-V1.1.4 使用说明 </center>

[TOC]



# <center> 项目介绍 </center>

本项目[RoyaleAnalyze](https://github.com/Arshtyi/RoyaleAnalyze)是依赖于[RoyaleAPI](https://royaleapi.com/)的皇室战争信息收集分析项目,项目截至本文更新至V1.1.4版本(见[CHANGELOG.md](https://github.com/Arshtyi/RoyaleAnalyze/blob/main/CHANGELOG.md)),因为项目主体已开发结束,故于2025/2/16正式暂停功能开发与更新(维护工作仍然继续),发行版见[releases](https://github.com/Arshtyi/RoyaleAnalyze/releases).

# <center> 项目依赖与环境 </center>

## 项目开发与运行环境

- 本项目使用_python3.12.7_开发,因为部分功能的原因,不保证兼容3.12更早的版本.
- 项目部分功能使用edge驱动,须确保edge版本(开发使用132.0.2957.140,更早版本测试时部分已不兼容)与驱动(某些平台上,这一功能需要一定权限)相容.
- 更推荐使用项目源代码,项目发行版仅测试过windows11系统,不保证其他平台的可行性.

## 项目主要依赖

- 项目依赖于[RoyaleAPI](https://royaleapi.com/).

- 请求头除动态驱动访问(这一部分使用无头模式)外均使用作者的请求头

- 代理设置但截至本文时间并未使用.

## 使用

- 确定目录结构完整无缺.
- 运行`main.py`或`main.exe`.

# <center> 项目主要目录 </center>

## assets

  如所见,这一文件夹下是使用说明(包括.md文件与PDF).

## src(发行版仅为可执行程序)

- 这一文件夹下为项目源代码,各模块的功能见后文(同时源代码中亦有注释说明).

- 发行版中,这一部分仅对应于`main.exe`文件,而源代码中对应于同级下的`main.py`入口函数.

## res

### icons

储存`RA.ico`文件.

## data

这一文件夹下是项目相关的数据文件,包括输入、输出与日志文件.

### input

#### 部落信息文件

该文件必须存在,存储需要查询的部落的(名字与)标签(保留\# 号).

#### 群内玩家信息文件

该文件并非必须,存储需要作为筛选参考的玩家信息,包括部落、昵称、QQ、标签(保留\#号).

### logs

该目录下存储各种日志文件.

### output

查询到的信息输出到该目录下.

# <center> 项目输入与输出 </center>

## 检查与更新

- 这不属于项目的菜单功能.
- 这会检查当前的各项路径与文件.
- 在错误不是很严重时,将尝试修复.
- 若错误十分严重或者修复不管用,抛出错误并终止程序.
- 若环境无误,程序进入下一阶段.

## 输入

### 输入文件

对应于路径`data/input`.

#### 部落信息

- 占位列是为了防止不经意的操作使得读取错误,不建议删除.

- 部落标签是必需的,名称本身将通过功能更新.

- 部落标签保留\#号.

- 不支持标记.

#### 玩家信息

- 这一文件并非是必须的,若不存在该文件或者所得结果为空,将输出一定信息并跳过筛选的选择.

- 占位列是为了防止不经意的操作使得读取错误,不建议删除.

- 玩家标签保留\#号.

- 玩家标签和QQ(该项对应于一个暂未开源的项目)、是否请假(支持`Y/y/是`三种形式)是必需的,更新功能中,将对非输入部落信息对应部落的玩家进行标记并不纳入玩家群体(同时请假玩家也被排除在外).

- 这一文件即筛选的参考,除开了其中请假成员与非我方部落成员.

### 控制台输入

- 控制台输入均为使用者的选项.
- 部分`y/n`选择同样支持`Y/N`(事实上,是`y/yes/n/no`的任意大小写形式).
- 输入类型不符合将导致直接抛出错误并退出.

## 输出

### 日志文件

- `data/logs`路径缺失将导致使用驱动的功能无法使用.

- 日志文件输出均来自edge.

### 控制台信息

控制台输出信息是为监控运行情况与引导选择.

### 输出文件

- 查询到的结果输出在`data/output`下.
- 每个表头记录该项启动的时间.
- 输出记录错误信息的日志.

## 注意事项

- 请确保路径的完整性,否则会直接抛出错误并退出(这一问题在V1.1.4之后已被另一方式解决).
- 关于失败后的尝试:
  - 失败目前只有可能是渲染超时造成的.
  - 失败后默认进行二次尝试(筛选选项继承),二次尝试失败则作罢.
  - 失败的信息经统计后将在格式化(这表明着这次运行的结束)后进行展示.

# <center> 项目功能 </center>

## 更新信息

- 根据`data/input`下信息作更新.

- 根据部落标签更新部落名称并录入信息.

- 根据玩家标签和请假情况更新玩家名称、部落再标记,将非标记玩家录入信息.

- 格式化`data/input`下文件.

## 清除输出

- 清除`data/output`下输出文件,若不存在,抛出信息.

## 查询部落战贡献

- 查询当前(这一周)各部落部落战贡献并录入,若当前未处于战斗日,将抛出信息并录入.

- 每个部落内按照贡献值进行降序排列.

- 查询信息包括使用卡组数量,袭击战船次数,贡献值.

- 不筛选情况下将对所有成员进行录入,筛选后将除去所有未录入的玩家信息.

- 对于$0$贡献进行标记.

## 查询捐赠

- 查询当前各部落捐赠情况并录入并按捐赠进行降序排列.
- 不筛选情况下将对所有成员进行录入,筛选后将除去所有未录入的玩家信息.
- 对于$0$捐赠进行标记.
- 每个部落内按照捐赠值进行降序排列.

## 查询活跃

- 查询当前各部落成员活跃情况(指距离当前时间的间隔).

- 对其中五天及以上未上线的成员进行标记.

- 不筛选情况下将对所有成员进行录入,筛选后将除去所有未录入的玩家信息.

- 不进行排序.

## 查询近一月部落战贡献

- 查询距今前四周(近一月)的部落战贡献情况
- 包括每一周及总计的使用卡组数和贡献值,以及近期参与河道竞速$P/A$的情况.
- 不筛选情况下将对所有成员进行录入,筛选后将除去所有未录入的玩家信息.
- 对于每个贡献值$0$进行标记.
- 每个部落内按照总计贡献值进行降序排列.

## 查询近一月捐赠

- 查询距今四周(近一月)的捐赠情况.

- 包括每一周及总计的捐赠值.

- 不筛选情况下将对所有成员进行录入,筛选后将除去所有未录入的玩家信息.

- 对于每个捐赠值$0$进行标记.

- 每个部落内按照总计捐赠值进行降序排列.

## 计算近一个月贡献

- 首先进行近一个月部落战贡献和捐赠的查询(这一操作不进行二次尝试,任何一个失败都将导致该功能终止).

- 在近一个月部落战贡献和捐赠进行加权计算总贡献.
- 支持修改权重.
- 不筛选情况下将对所有成员进行录入,筛选后将除去所有未录入的玩家信息.
- 对于$0$部落战贡献、捐赠、贡献进行标记.
- 所有数据按照贡献值降序排列.
- 记录权重.
- 不支持各部落分别查询,仅可通过修改输入文件达到目的.

## 查询最近部落成员变动

- 查询近期各部落成员变动.

- 无筛选.

- 加入和退出二者之一以背景色标记.

- 计算合计情况.

- 查询该部落当前成员数.

## 格式化

- 进行输出文件的格式化:读取字符宽度,调整列宽,删除多余工作表.

# <center> Q&A </center>



> [!CAUTION]
>
> Q:有没有图形界面？
>
> A:这只是一个小脚本,没有打算做图形界面,不过另一个替代项目正在开发中.

> [!CAUTION]
>
> Q:为什么有时感觉缺少一些数据？
>
> A:这可能是[RoyaleAPI](https://royaleapi.com/)本身导致的,因为默认下该项目仅查询当前玩家(即查询时部落内玩家)的相关信息,如果该成员已经退出或者是在查询时间范围内存在不在该部落的情况,都可能使得数据为空或者信息为空.

> [!CAUTION]
>
> Q:项目足够稳定吗？
>
> A:从目前的测试看,仅有使用驱动访问页面的功能会偶尔出现错误(这些错误在运行第二次后会被解决),其他功能没有出现BUG.

> [!NOTE]
>
> 这一问题在V1.1.4后彻底解决.

> [!CAUTION]
>
> Q:跨平台性如何？
>
> A:源代码不保证支持_python3.12_更早版本,发行版windows与linux可行,mac未知.

> [!CAUTION]
>
> Q:目前开发情况？
>
> A:目前该脚本主体已经完成了所有功能开发,最新版本[V1.1.4](https://github.com/Arshtyi/RoyaleAnalyze/releases)仅有部分BUG未修复(如果你发现了这些BUG或者有一些关于开发的想法,可以来提[issue](https://github.com/Arshtyi/RoyaleAnalyze/issues)或者[pr](https://github.com/Arshtyi/RoyaleAnalyze/pulls)).

> [!CAUTION]
>
> Q:标记的标准是否支持自定义？
>
> A:出于两个原因不支持:
>
> - 皇室战争各项数据的范围相对死板固定,没有必要做这个自定义.
> - ~~作者比较懒~~.

> [!CAUTION]
>
> Q:未来开放方向？
>
> A:本项目主体已于2025/2/16完成所有功能开发,后续本项目会再进行一段时间的BUG修复,之后停止维护,转而开发另一个替代项目(暂未开源).



# <center> 联系作者 </center>

## 项目主页

[RoyaleAnalyze](https://github.com/Arshtyi/RoyaleAnalyze)

## QQ

640006128或3842004484

## email

上述QQ邮箱或者<8956230x@gmail.com>

## 我们的交流群

939160021

# <center> 开源事项 </center>

- 开源许可[LICENSE](https://github.com/Arshtyi/RoyaleAnalyze/blob/main/LICENSE)
- 各种开发事项欢迎提[issue](https://github.com/Arshtyi/RoyaleAnalyze/issues)或者[pr](https://github.com/Arshtyi/RoyaleAnalyze/pulls)
